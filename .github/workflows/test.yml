name: Test
on:
  push:

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
      with:
        ref: master
        fetch-depth: 0
    - uses: actions/checkout@v2
      with:
        fetch-depth: 0

    - name: checkout and docker run
      run: |
        git checkout $(git merge-base HEAD master)
        docker run \
          -d \
          --name mysql-skeema \
          -v $(pwd)/sql/:/docker-entrypoint-initdb.d/ \
          -e MYSQL_DATABASE=test \
          -e MYSQL_ALLOW_EMPTY_PASSWORD=yes \
          -e TZ=Asia/Tokyo \
          -p 3306:3306 \
          mysql:5.7

    - name: test get merge-base
      run: which mysql

